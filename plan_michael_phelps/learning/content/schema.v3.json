{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://english-sprint.local/schema.v3.json",
  "title": "English Sprint Week Content V3",
  "type": "object",
  "required": [
    "version",
    "week",
    "title",
    "domain",
    "week_profile",
    "focus",
    "book_modules",
    "assessment",
    "adaptive_overrides",
    "weekly_gate",
    "days"
  ],
  "properties": {
    "version": {
      "type": "string",
      "const": "v3"
    },
    "week": {
      "type": "integer",
      "minimum": 1,
      "maximum": 20
    },
    "title": {
      "type": "string",
      "minLength": 3
    },
    "domain": {
      "type": "string",
      "enum": [
        "general_tech_balanced",
        "software_tech"
      ]
    },
    "week_profile": {
      "type": "object",
      "required": [
        "phase",
        "cefr_target",
        "domain_mix",
        "cognitive_load",
        "central_task"
      ],
      "properties": {
        "phase": {
          "type": "string"
        },
        "cefr_target": {
          "type": "string"
        },
        "domain_mix": {
          "type": "object",
          "required": [
            "general",
            "tech"
          ],
          "properties": {
            "general": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100
            },
            "tech": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100
            }
          }
        },
        "cognitive_load": {
          "type": "string",
          "enum": [
            "low",
            "medium",
            "high"
          ]
        },
        "central_task": {
          "type": "string"
        }
      }
    },
    "focus": {
      "type": "object",
      "required": [
        "grammar",
        "functions",
        "pronunciation"
      ],
      "properties": {
        "grammar": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string"
          }
        },
        "functions": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string"
          }
        },
        "pronunciation": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string"
          }
        }
      }
    },
    "book_modules": {
      "type": "object",
      "required": [
        "grammar",
        "vocabulary",
        "pronunciation",
        "reader",
        "theory"
      ],
      "properties": {
        "grammar": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string"
          }
        },
        "vocabulary": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string"
          }
        },
        "pronunciation": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string"
          }
        },
        "reader": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string"
          }
        },
        "theory": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string"
          }
        }
      }
    },
    "assessment": {
      "type": "object",
      "required": [
        "type",
        "checkpoint_week",
        "pass_criteria"
      ],
      "properties": {
        "type": {
          "type": "string"
        },
        "checkpoint_week": {
          "type": "boolean"
        },
        "pass_criteria": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string"
          }
        }
      }
    },
    "adaptive_overrides": {
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "weekly_gate": {
      "type": "object",
      "required": [
        "description",
        "checks"
      ],
      "properties": {
        "description": {
          "type": "string"
        },
        "checks": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string"
          }
        }
      }
    },
    "days": {
      "type": "object",
      "required": [
        "Mon",
        "Tue",
        "Wed",
        "Thu",
        "Fri",
        "Sat",
        "Sun"
      ],
      "additionalProperties": false,
      "properties": {
        "Mon": {
          "$ref": "#/$defs/day"
        },
        "Tue": {
          "$ref": "#/$defs/day"
        },
        "Wed": {
          "$ref": "#/$defs/day"
        },
        "Thu": {
          "$ref": "#/$defs/day"
        },
        "Fri": {
          "$ref": "#/$defs/day"
        },
        "Sat": {
          "$ref": "#/$defs/day"
        },
        "Sun": {
          "$ref": "#/$defs/day"
        }
      }
    }
  },
  "$defs": {
    "block": {
      "type": "object",
      "required": [
        "name",
        "minutes",
        "instructions"
      ],
      "properties": {
        "name": {
          "type": "string"
        },
        "minutes": {
          "type": "integer",
          "minimum": 1
        },
        "instructions": {
          "type": "string"
        }
      }
    },
    "rubric_dimension": {
      "type": "object",
      "required": [
        "target",
        "descriptor"
      ],
      "properties": {
        "target": {
          "type": "integer",
          "minimum": 0,
          "maximum": 3
        },
        "descriptor": {
          "type": "string"
        }
      }
    },
    "exercise": {
      "type": "object",
      "required": [
        "type",
        "instructions",
        "output"
      ],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "retrieval_quiz",
            "error_rewrite",
            "guided_listening_sheet",
            "chunk_extraction",
            "roleplay_task",
            "repair_drill",
            "pron_shadow_task",
            "writing_transform_task"
          ]
        },
        "instructions": {
          "type": "string"
        },
        "output": {
          "type": "string"
        }
      }
    },
    "resource_use": {
      "type": "object",
      "required": [
        "id",
        "minutes",
        "purpose"
      ],
      "properties": {
        "id": {
          "type": "string"
        },
        "minutes": {
          "type": "integer",
          "minimum": 1
        },
        "purpose": {
          "type": "string"
        }
      }
    },
    "metrics_targets": {
      "type": "object",
      "required": [
        "error_density_max",
        "repair_success_min",
        "turn_length_min_seconds",
        "gist_min",
        "detail_min",
        "lexical_reuse_min",
        "pronunciation_score_min"
      ],
      "properties": {
        "error_density_max": {
          "type": "number"
        },
        "repair_success_min": {
          "type": "number"
        },
        "turn_length_min_seconds": {
          "type": "number"
        },
        "gist_min": {
          "type": "number"
        },
        "detail_min": {
          "type": "number"
        },
        "lexical_reuse_min": {
          "type": "number"
        },
        "pronunciation_score_min": {
          "type": "number"
        }
      }
    },
    "day": {
      "type": "object",
      "required": [
        "minutes",
        "goal",
        "task_design",
        "blocks",
        "sesame",
        "reading",
        "writing",
        "daily_exercises",
        "resource_pack",
        "book_modules",
        "deliverables",
        "rubric",
        "metrics",
        "metrics_targets",
        "adaptive_overrides",
        "daily_gate"
      ],
      "properties": {
        "minutes": {
          "type": "integer",
          "minimum": 1
        },
        "goal": {
          "type": "string"
        },
        "task_design": {
          "type": "string"
        },
        "blocks": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/$defs/block"
          }
        },
        "sesame": {
          "type": "object",
          "required": [
            "prompt",
            "rounds"
          ],
          "properties": {
            "prompt": {
              "type": "string",
              "minLength": 8
            },
            "rounds": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "string"
              }
            }
          }
        },
        "reading": {
          "type": "object",
          "required": [
            "task",
            "output"
          ],
          "properties": {
            "task": {
              "type": "string"
            },
            "output": {
              "type": "string"
            }
          }
        },
        "writing": {
          "type": "object",
          "required": [
            "task",
            "genre",
            "min_words",
            "output"
          ],
          "properties": {
            "task": {
              "type": "string"
            },
            "genre": {
              "type": "string"
            },
            "min_words": {
              "type": "integer",
              "minimum": 30
            },
            "output": {
              "type": "string"
            }
          }
        },
        "daily_exercises": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/$defs/exercise"
          }
        },
        "resource_pack": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/$defs/resource_use"
          }
        },
        "book_modules": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string"
          }
        },
        "deliverables": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string"
          }
        },
        "rubric": {
          "type": "object",
          "required": [
            "fluency",
            "accuracy",
            "interaction",
            "pronunciation"
          ],
          "properties": {
            "fluency": {
              "$ref": "#/$defs/rubric_dimension"
            },
            "accuracy": {
              "$ref": "#/$defs/rubric_dimension"
            },
            "interaction": {
              "$ref": "#/$defs/rubric_dimension"
            },
            "pronunciation": {
              "$ref": "#/$defs/rubric_dimension"
            }
          }
        },
        "metrics": {
          "type": "object",
          "required": [
            "error_density",
            "repair_success",
            "turn_length",
            "comprehension_split",
            "lexical_reuse"
          ],
          "properties": {
            "error_density": {
              "type": "string"
            },
            "repair_success": {
              "type": "string"
            },
            "turn_length": {
              "type": "string"
            },
            "comprehension_split": {
              "type": "string"
            },
            "lexical_reuse": {
              "type": "string"
            }
          }
        },
        "metrics_targets": {
          "$ref": "#/$defs/metrics_targets"
        },
        "adaptive_overrides": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "daily_gate": {
          "type": "string",
          "minLength": 8
        }
      }
    }
  }
}
